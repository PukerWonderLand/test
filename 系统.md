 WTG是Windows的一项功能，可以将完整的Windows操作系统安装至可移动存储介质内。





### 二、WTG的好处是什么？



1，WTG与虚拟机相比，不占用原有的磁盘空间。

2，WTG和使用它的设备相互独立，资料互不影响。

3，WTG的U盘可以随身携带，数据安全性高。

4，WTG可以让你随时随地使用自己熟悉的办公环境。

5，WTG里安装自己需要的软件后可以在不同的电脑上使用，不必再次重复安装该软件。

6，对于容量小的苹果电脑，又有Windows系统需求的人来说，WTG也是不错的选择。

7，WTG对本人来说最大的好处是，随时随地封装系统。



怎么说呢，以前我封装系统和做教程都是只能下班回家搞，所以你们看我发的帖子一般都是晚上发表的。

因为，台式电脑总不可能上班搬到铺子上，下班搬回家，那样只会累死，几十上百G的虚拟机和封装资料，用U盘或者移动硬盘拷来考去也不现实，而且铺子上的电脑，随时都在变动，封装环境不稳定。

所以有了WTG，可以把上班空闲时间利用起来搞封装系统，家里和上班两不误。





### 三、WTG有什么要求？



硬件要求





 既然是讲WTG，就不得不先提一下4K读写性能。4K是磁盘最小的读写单位。也就是说，文件读写最小是4k，文件存储大小不足4k自动补齐到4k再读写。例如我们需要写入1个2K的数据，其实得写入4K。如果我们需要写入13K的数据，我们就要写入16K大小的数据（这里未考虑写入放大因素）。





4K随机读写性能代表了硬盘的数据吞吐能力(单位为iops)，与持续读写性能相对。





如果4K读写速度低于1M/S，开机时间在2分钟以上，这样的WTG体验很不好，使用意义不大。所以，4K读写速度低于1M/S的移动存储设备不推荐做WTG。





其实就是容量＞32G+速度较快的USB3.0 U盘而已





**==WTG已经内置==**在 Windows 8/8.1/10 企业版、Windows 10 教育版和 1607 版本及之后的 Windows 10 专业版的系统中，

**==只需要进入控制面板里安装即可==**。



当然，如果你的系统没有满足以上条件的话，你也可以使用第三方WTG工具来制作，

第三方工具相对于官方工具来说限制条件会少许多，比如非企业版Windows系统，如家庭版 Win 10，都可以使用第三方WTG工具（如 WinToGo Assistant、WinToUSB Free等）实现，而且条件限制会更少。

如果你的原机甚至没有操作系统，你也可以进入==PE里制==作，比如此篇教程用到的工具**==DISM++==**，这个工具的好处是可以在是桌面运行环境制作，也可以是PE里制作。

**==对于WTG镜像，强烈建议使用微软原版官方镜像==**，**==不要用精简过的或者封装过的镜像，这样才能最大限度的避免安装过程或者使用过程中出现不可预测的未知错误。==**

如果觉得原版系统不好用，你可以在安装好WTG之后，用本人的系统封装优化设置辅助工具进行新机一键优化清理就行了。





### 四、使用WTG注意事项有哪些？

1，**==不要使用BitLocker加密==**，否则很容易进不去系统。

2，对于驱动问题**==，最好不要去主动安装驱动==**，一般系统自带一些通用的驱动，联网也会更新大部分驱动，除了独立显卡驱动，其他驱动基本都会自动安装。

3，不过，最好准备一个IT天空的**==万能驱动7==**在固态U盘里，在不同的电脑上使用WTG，硬件不同，所需要的驱动也不同，虽然WTG系统自带一些通用的驱动，联网也会更新大部分驱动，但是有些可能要用到的特殊驱动不一定有，可借助万能驱动7安装。比如，Surface触摸屏驱动。

4，如果是纯办公，不娱乐，**==建议不要主动安装独立显卡驱动==**。

5，第一次启动进桌面可能会有些慢或者卡顿，那是在联网更新驱动，第二次在相同机器上启动就快了。

6，WTG系统不能休眠、快速启动和重置。也就是说在WTG里，**每次电脑开机速度和电脑重启速度是一样的**。

7，最好使用**==GPT+UEFI方式做WTG==**，**避免出现无法引导，兼容性更高一些**。

8，最好将整个**==固态U盘只分一个分区==**，避免出错，系统文件夹和工作文件夹单独分开建立就行了。

9，不能在运行WTG的时候拔掉固态U盘，这样会导致蓝屏死机的情况，甚至可能丢失文件或者损坏U盘。

10，如果遇到了卡在OOBE的问题，比如在第一次引导时如果提示“Windows无法更改此计算机的启动配置”，这时按Shift+F10可以进入CMD，输入oobe\msoobe.exe就可以进入下一步。







# **备份系统个性设置**



封装系统时，系统的某些设置，在重装系统后会被还原，

所以需要使用辅助工具的系统个性设置备份还原功能来解决这个问题。





系统个性设置也分为备份和还原两部分，

备份部分是在PE系统里完成，在执行封装前备份。

而还原部分需要**==在PE系统里执行封装后==**，**==打包镜像前进行还原==**。



注意：同样的，**==备份的时候用哪个文件夹里的辅助工具备份，还原的时候就一定要用其进行还原==**，否则无效，切记！按照下图操作即可。













# 只有所有用户的软件，才能被系统封装





使用优启通+ES5S+万能驱动封装出来的系统具有封装特权，不会有任何推广，并且可以直接删掉附带的推广软件，减小封装镜像的体积。如果不是全套IT天空产品封装的系统就不能删，否则部署过程中万能驱动就会报错。定位到如下图路径位置，按住Shift+Delete删除即可。







有时候我们重装系统后会出现白板图标，双击白板图标又能正常打开应用程序，这个情况就是图标缓存问题。

接下来我们来清理一下目标系统的图标缓存，定位到目标系统的如下路径位置，Shfit+Delete删除IconCache.db文件。





继续定位到如下路径位置，全选删除Explorer里的所有文件





部署设置，计算机名我选的是[前缀]-[日期][随机]，这样计算机名一般不会重复







添加部署任务，有些文件或文件夹权限比较高，自解压文件运行覆盖替换过程中可能会报错。

所以在部署前，提前将即将被自解压文件覆盖替换的软件目录全部删除掉。按照下图操作即可。





# 妈的，少一个步骤

**在部署后调用万能激活**，并设置静默参数/k19，激活到2038年。万能激活路径为【%SystemDrive%\ProgramData\Microsoft\Windows\Start Menu\Programs\专业工具\激活工具\EasyActivate_V1.02.6.exe】，即之前拷贝进系统里的专业工具文件夹里。注意参数和路径之间有个空格。





# 虽然有加密，但是可以自己加点东西

当然，如果虚拟机快照一直保存着，或者封装后的ES5S设置一直保存着的话，可以通过在PE里补充ES5S二阶段执行的方式修改镜像任务等等。但是虚拟机和配置文件一般不方便保存。比如，下载了别人的镜像，你也肯定找不到人家的ES5S配置文件。这时怎么办？比如我们要修改一下别人的系统，使其进入桌面后运行某个程序，怎么操作？或者我自己的系统，对应的ES5S配置找不到了，想修改一下进入桌面执行某个操作，怎么办？那么接下来，我就来做一个不依赖于ES5S的通用批处理调用任务。这个任务是为了方便以后添加或更改镜像重装系统后进入桌面后的任务。如下图，分别是之前拷贝进去的RunOnce.bat，RunOnce.vbs，RunOnce.reg几个文件的内容和作用说明。



现在的新出来的intel11代平台的笔记本的存储一般都默认是raid模式，需要提前注入对应的驱动才能防止重装系统蓝屏的问题。这里用下图中的工具一键注入即可，安装位置选择目标系统的磁盘根目录即可

































